<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lycée de l’Excellence - Physique</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <!-- MathJax for LaTeX rendering -->
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
  <!-- Header -->
  <header>
    <div>
      <div>
        <img id="mainLogo" alt="Logo" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ0IiB2aWV3Qm94PSIwIDAgNTE2IDUxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBmaWxsPSIjMzQ5OGRiIiBkPSJNMjU2IDhjMTE5IDAgMjE2IDk3IDIxNiAyMTZzLTk3IDIxNi0yMTYgMjE2cy0yMTYtOTctMjE2LTIxNlMxMzcgOCAyNTYgOHptMCA0NDhjMTEwLjUgMCAyMDAtODkuNSAyMDAtMjAwIDAtMTEwLjUtODkuNS0yMDAtMjAwLTIwQzM2NSA1NiAyNTYgMTQ1LjUgMjU2IDI1NmMwIDExMDUgODkuNSAyMDAgMjAwIDIwMHoiLz48L3N2Zz4=" onerror="this.style.display='none';" />
        <h1 id="siteTitle">Lycée de l'Excellence</h1>
      </div>
      <nav>
        <ul>
          <li><a href="#" class="nav-link" data-section="home">Accueil</a></li>
          <li><a href="#" class="nav-link" data-section="dictionary">Lexique</a></li>
          <li><a href="#" class="nav-link" data-section="quiz">Quiz</a></li>
          <li><a href="#" class="nav-link" data-section="grades">Notes</a></li>
          <li><a href="#" class="nav-link" data-section="exams">Examens</a></li>
          <li><a href="#" class="nav-link" data-section="exercises">Exercices</a></li>
          <li><a href="#" class="nav-link" data-section="lessons">Leçons</a></li>
        </ul>
      </nav>
      <div>
        <button id="studentLoginBtn"><i class="fa-solid fa-user-graduate"></i> Espace Élève</button>
        <button id="loginBtn"><i class="fa-solid fa-user-shield"></i> Espace Professeur</button>
      </div>
    </div>
  </header>
  <!-- Hero -->
  <section id="home-section">
    <div>
      <h2>Bienvenue au Lycée de l'Excellence</h2>
      <p>Plateforme éducative dédiée à la physique sous la supervision du Professeur Ali Bairouk</p>
    </div>
  </section>
  <!-- Announcement -->
  <div id="announcementBox">
    <i class="fas fa-bullhorn"></i>
    <div>
      <p id="announcementText">ستبدأ الدراسة الفعلية يوم 16/09/2025 نتمنى لتلاميذ والتلميذات سنة دراسية مليئة بالجد ومثمرة</p>
      <img id="announcementImage" src="" alt="Announcement image" style="display:none;max-width:320px;">
    </div>
  </div>
  <!-- Slider under announcement -->
  <div id="front-hero-slider"></div>
  <div>
    <!-- Features -->
    <h2>Sections du Site</h2>
    <div>
      <div data-section="dictionary">
        <div><i class="fas fa-book"></i></div>
        <div><h3>Lexique Scientifique</h3><p>Traduction des termes scientifiques عربى → français.</p></div>
      </div>
      <div data-section="quiz">
        <div><i class="fas fa-question-circle"></i></div>
        <div><h3>Quiz</h3><p>اختبارات تفاعلية احترافية.</p></div>
      </div>
      <div data-section="grades">
        <div><i class="fas fa-chart-line"></i></div>
        <div><h3>Notes</h3><p>عرض النقاط عبر حساب التلميذ أو Code Parcours.</p></div>
      </div>
      <div data-section="exams">
        <div><i class="fas fa-file-alt"></i></div>
        <div><h3>Examens Antérieurs</h3><p>امتحانات مع التصحيحات.</p></div>
      </div>
      <div data-section="exercises">
        <div><i class="fas fa-tasks"></i></div>
        <div><h3>Exercices et Solutions</h3><p>تمارين محلولة بتفصيل.</p></div>
      </div>
      <div data-section="lessons">
        <div><i class="fas fa-graduation-cap"></i></div>
        <div><h3>Leçons</h3><p>دروس شاملة للبرنامج.</p></div>
      </div>
    </div>
    <!-- Student Dashboard -->
    <section id="student-dashboard" style="display:none;">
      <div>
        <h2 id="studentWelcome">Bienvenue, Élève</h2>
        <p>Vous trouverez ici toutes vos ressources pédagogiques</p>
      </div>
      <!-- Student Tabs Navigation -->
      <div>
        <div class="student-tab active" data-tab="dashboard">Tableau de bord</div>
        <div class="student-tab" data-tab="quiz">Quiz</div>
        <div class="student-tab" data-tab="exercises">Exercices</div>
        <div class="student-tab" data-tab="dictionary">Lexique</div>
        <div class="student-tab" data-tab="revision">Demande de récorrection</div>
        <div class="student-tab" data-tab="messages">الرسائل</div>
        <div class="student-tab" data-tab="cours">Cours online</div>
      </div>
      <!-- Dashboard tab content -->
      <div id="student-dashboard-tab" class="student-tab-content active">
        <div>
          <h3>Vos Notes Récentes</h3>
          <div id="studentRecentGrades"><p>Aucune note disponible pour le moment.</p></div>
        </div>
        <div>
          <h3>Quiz disponibles</h3>
          <div id="studentQuizList"><p>Aucun quiz disponible pour le moment.</p></div>
        </div>
        <div>
          <h3>Ressources Disponibles</h3>
          <div id="studentResources"></div>
        </div>
      </div>
      <!-- Student Quiz tab -->
      <div id="student-quiz-tab" class="student-tab-content">
        <div>
          <h3>Quiz Disponibles</h3>
          <div id="studentQuizList"><p>Aucun quiz disponible pour le moment.</p></div>
        </div>
        <div>
          <h3>Résultats des Quiz</h3>
          <div id="studentQuizResults"><p>Aucun résultat de quiz pour le moment.</p></div>
        </div>
        <!-- Quiz runtime container -->
        <div id="quizContainer" style="display:none;"></div>
      </div>
      <!-- Exercises, Dictionary, Revision, Messages, Cours tabs -->
      <div id="student-exercises-tab" class="student-tab-content">
        <div>
          <h3>Exercices Disponibles</h3>
          <div id="studentExercisesList"></div>
        </div>
      </div>
      <div id="student-dictionary-tab" class="student-tab-content">
        <div>
          <h3>Lexique Scientifique</h3>
          <div id="studentDictionaryContent"></div>
        </div>
      </div>
      <div id="student-revision-tab" class="student-tab-content">
        <div>
          <h3>Demande de Récorrection de Note</h3>
          <div>
            <form id="revisionRequestForm">
              <div>
                <label for="revisionExam">Examen/Devoir</label>
                <select id="revisionExam" required><option value="">Sélectionnez une évaluation</option></select>
              </div>
              <div>
                <label for="revisionMessage">Message</label>
                <textarea id="revisionMessage" rows="3" required></textarea>
              </div>
              <button type="submit">Envoyer la demande</button>
            </form>
          </div>
        </div>
        <div>
          <h3>Vos Demandes de Récorrection</h3>
          <div id="studentRevisionRequests"><p>Vous n'avez pas encore soumis de demandes de récorrection.</p></div>
        </div>
      </div>
      <div id="student-messages-tab" class="student-tab-content">
        <div>
          <h3>الرسائل الموجهة إليك</h3>
          <div id="studentMessagesList"><p>لا توجد رسائل حتى الآن.</p></div>
        </div>
      </div>
      <div id="student-cours-tab" class="student-tab-content">
        <div>
          <h3>الدروس العلمية - Cours online</h3>
          <div id="studentCoursList"><p>لا توجد دروس متاحة حتى الآن.</p></div>
        </div>
      </div>
      <div>
        <button id="studentLogoutBtn"><i class="fa-solid fa-right-from-bracket"></i> Déconnexion</button>
      </div>
    </section>
    <!-- Other sections -->
    <section id="dictionary" style="display:none;">
      <div><h2>Lexique Scientifique</h2><p>Ar → Fr</p></div>
      <div id="dictionaryContent"></div>
    </section>
    <section id="quiz" style="display:none;">
      <div><h2>Quiz de Physique</h2><p>Testez vos connaissances</p></div>
      <div id="quizContent"></div>
    </section>
    <section id="grades" style="display:none;">
      <div><h2>Consultation des Notes</h2></div>
      <div>
        <div>
          <div>
            <div>
              <div>
                <label for="searchCode">Code Parcours</label>
                <input type="text" id="searchCode" placeholder="Ex: P-2024-001">
              </div>
              <div>
                <label>&nbsp;</label>
                <button id="btnSearchByCode"><i class="fa-solid fa-magnifying-glass"></i> Voir les notes</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id="gradesResults" style="display:none">
        <h3>Vos Résultats</h3>
        <div id="studentInfo"></div>
        <div>
          <div>
            <table id="gradesTable">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Matière</th>
                  <th>Intitulé</th>
                  <th>Note /20</th>
                  <th>Remarque</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
            <p id="noGradesMsg" style="display:none">Aucune note pour le moment.</p>
          </div>
        </div>
      </div>
    </section>
    <section id="exams" style="display:none;">
      <div><h2>Examens Antérieurs</h2><p>Consultez & téléchargez</p></div>
      <div id="examsContent"></div>
    </section>
    <section id="exercises" style="display:none;">
      <div><h2>Exercices et Solutions</h2><p>تمارين محلولة بتفصيل</p></div>
      <div id="exercisesContent"></div>
    </section>
    <section id="lessons" style="display:none;">
      <div><h2>Leçons</h2><p>دروس شاملة للبرنامج</p></div>
      <div id="lessonsContent"></div>
    </section>
    <!-- Admin Panel -->
    <section id="admin-panel" style="display:none;">
      <div>
        <h2>Panneau d'Administration</h2>
        <div>
          <button id="btnExport"><i class="fa-solid fa-file-export"></i> Exporter JSON</button>
          <label for="importFile"><i class="fa-solid fa-file-import"></i> Importer JSON</label>
          <input type="file" id="importFile" accept="application/json" style="display:none">
          <button id="logoutBtn"><i class="fa-solid fa-right-from-bracket"></i> Déconnexion</button>
        </div>
      </div>
      <div>
        <div>
          <h3>Tableau de Bord</h3>
          <ul>
            <li><a href="#" class="admin-tab-link active" data-tab="tab-dashboard"><i class="fas fa-tachometer-alt"></i> Tableau de bord</a></li>
            <li><a href="#" class="admin-tab-link" data-tab="tab-students"><i class="fa-solid fa-users"></i> Étudiants</a></li>
            <li><a href="#" class="admin-tab-link" data-tab="tab-grades"><i class="fa-solid fa-chart-line"></i> Notes</a></li>
            <li><a href="#" class="admin-tab-link" data-tab="tab-quiz"><i class="fa-solid fa-question-circle"></i> Quiz</a></li>
            <li><a href="#" class="admin-tab-link" data-tab="tab-dictionary"><i class="fa-solid fa-book"></i> Lexique</a></li>
            <li><a href="#" class="admin-tab-link" data-tab="tab-lessons"><i class="fa-solid fa-graduation-cap"></i> Leçons</a></li>
            <li><a href="#" class="admin-tab-link" data-tab="tab-exercises"><i class="fa-solid fa-tasks"></i> Exercices</a></li>
            <li><a href="#" class="admin-tab-link" data-tab="tab-exams"><i class="fa-solid fa-file-alt"></i> Examens</a></li>
            <li><a href="#" class="admin-tab-link" data-tab="tab-announcement"><i class="fa-solid fa-bullhorn"></i> Annonces</a></li>
            <li><a href="#" class="admin-tab-link" data-tab="tab-revisions"><i class="fa-solid fa-edit"></i> Demandes de récorrection</a></li>
            <li><a href="#" class="admin-tab-link" data-tab="tab-messages"><i class="fa-solid fa-envelope"></i> الرسائل</a></li>
            <li><a href="#" class="admin-tab-link" data-tab="tab-latex"><i class="fa-solid fa-square-root-variable"></i> LaTeX Courses</a></li>
            <li><a href="#" class="admin-tab-link" data-tab="tab-sitecover"><i class="fa-solid fa-image"></i> Site Cover</a></li>
            <li><a href="#" class="admin-tab-link" data-tab="tab-slider"><i class="fa-solid fa-images"></i> Slider</a></li>
          </ul>
        </div>
        <div>
          <!-- Dashboard -->
          <div id="tab-dashboard" class="admin-section active">
            <h2>Tableau de Bord</h2>
            <div>
              <div><h3 id="stats-students">0</h3><p>Étudiants</p></div>
              <div><h3 id="stats-quiz">0</h3><p>Questions de Quiz</p></div>
              <div><h3 id="stats-dictionary">0</h3><p>Termes de Lexique</p></div>
              <div><h3 id="stats-grades">0</h3><p>Notes Enregistrées</p></div>
              <div><h3 id="stats-messages">0</h3><p>رسائل</p></div>
              <div><h3 id="stats-latex">0</h3><p>دروس LaTeX</p></div>
            </div>
            <div>
              <div><h3>Activité Récente</h3><div id="recent-activity"><p>Aucune activité récente.</p></div></div>
            </div>
          </div>
          <!-- Students -->
          <div id="tab-students" class="admin-section">
            <div>
              <div>
                <h3>Créer / Modifier un Étudiant</h3>
                <div>
                  <div>
                    <label>Nom complet</label>
                    <input id="stFullname" type="text" placeholder="Ex: Ahmed Amine">
                  </div>
                  <div>
                    <label>Nom d'utilisateur</label>
                    <input id="stUsername" type="text" placeholder="Ex: ahmed.amine">
                  </div>
                </div>
                <div>
                  <div>
                    <label>Mot de passe</label>
                    <input id="stPassword" type="text" placeholder="••••••">
                  </div>
                  <div>
                    <label>Code Parcours</label>
                    <input id="stCode" type="text" placeholder="Ex: P-2024-001">
                  </div>
                </div>
                <div>
                  <div>
                    <label>Classe</label>
                    <input id="stClassroom" type="text" placeholder="2ème Bac Sciences Physiques">
                  </div>
                  <div>
                    <label>&nbsp;</label>
                    <div>
                      <button id="btnSaveStudent"><i class="fa-solid fa-save"></i> Enregistrer</button>
                      <button id="btnResetStudent">Vider</button>
                    </div>
                  </div>
                </div>
                <input type="hidden" id="stId">
              </div>
            </div>
            <div>
              <div>
                <div><strong>Liste des Étudiants</strong><input id="filterStudents" placeholder="Filtrer..." /></div>
                <table id="studentsTable">
                  <thead>
                    <tr>
                      <th>Nom</th>
                      <th>Utilisateur</th>
                      <th>Code</th>
                      <th>Classe</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>
          <!-- Grades -->
          <div id="tab-grades" class="admin-section">
            <div>
              <div>
                <h3>Ajouter une Note</h3>
                <div>
                  <div>
                    <label>Étudiant</label>
                    <select id="grStudent"></select>
                  </div>
                  <div>
                    <label>Matière</label>
                    <input id="grSubject" type="text" placeholder="Électricité, Mécanique...">
                  </div>
                </div>
                <div>
                  <div>
                    <label>Intitulé</label>
                    <input id="grTitle" type="text" placeholder="Contrôle 1">
                  </div>
                  <div>
                    <label>Date</label>
                    <input id="grDate" type="date">
                  </div>
                </div>
                <div>
                  <div>
                    <label>Note /20</label>
                    <input id="grScore" type="number" min="0" max="20" step="0.25" placeholder="16.5">
                  </div>
                  <div>
                    <label>Remarque</label>
                    <input id="grNote" type="text" placeholder="Très bien">
                  </div>
                </div>
                <input type="hidden" id="grId">
                <div>
                  <button id="btnSaveGrade"><i class="fa-solid fa-plus"></i> Enregistrer la note</button>
                  <button id="btnResetGrade">Vider</button>
                </div>
              </div>
            </div>
            <div>
              <div>
                <div><strong>Notes par Étudiant</strong><select id="grFilterStudent"></select></div>
                <table id="gradesAdminTable">
                  <thead>
                    <tr>
                      <th>Étudiant</th>
                      <th>Date</th>
                      <th>Matière</th>
                      <th>Intitulé</th>
                      <th>Note</th>
                      <th>Remarque</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>
          <!-- Quiz -->
          <div id="tab-quiz" class="admin-section">
            <div>
              <div>
                <h3>Créer / Gérer Quiz Professionnel</h3>
                <div>
                  <div>
                    <label>Titre du quiz</label>
                    <input id="newQuizTitle" type="text" placeholder="Titre du quiz">
                  </div>
                  <div>
                    <label>Durée (minutes, 0 = sans limite)</label>
                    <input id="newQuizDuration" type="number" min="0" value="0">
                  </div>
                </div>
                <div>
                  <label><input type="checkbox" id="newQuizShuffle"> Mélanger questions</label>
                  <label><input type="checkbox" id="newQuizAllowMultipleAttempts"> Autoriser plusieurs tentatives</label>
                </div>
                <div><button id="btnCreateQuiz"><i class="fa-solid fa-plus"></i> Créer Quiz</button></div>
              </div>
            </div>
            <div>
              <div>
                <h3>Ajouter une question</h3>
                <div>
                  <label>Sélectionnez quiz</label>
                  <select id="adminSelectQuiz"></select>
                </div>
                <div>
                  <label>Question</label>
                  <input id="adminQuizQuestion" type="text" placeholder="Entrez la question">
                </div>
                <div>
                  <div>
                    <label>Type de question</label>
                    <select id="adminQuestionType">
                      <option value="single">Choix unique</option>
                      <option value="multiple">Choix multiple</option>
                    </select>
                  </div>
                  <div>
                    <label>Points</label>
                    <input id="adminQuestionPoints" type="number" min="1" value="1">
                  </div>
                </div>
                <div>
                  <label>Option 1</label>
                  <input id="adminOption1" type="text" placeholder="Option 1">
                </div>
                <div>
                  <label>Option 2</label>
                  <input id="adminOption2" type="text" placeholder="Option 2">
                </div>
                <div>
                  <label>Option 3 (optionnel)</label>
                  <input id="adminOption3" type="text" placeholder="Option 3">
                </div>
                <div>
                  <label>Option 4 (optionnel)</label>
                  <input id="adminOption4" type="text" placeholder="Option 4">
                </div>
                <div>
                  <label>Option 5 (optionnel)</label>
                  <input id="adminOption5" type="text" placeholder="Option 5">
                </div>
                <div>
                  <label>Option 6 (optionnel)</label>
                  <input id="adminOption6" type="text" placeholder="Option 6">
                </div>
                <div>
                  <div>
                    <label>Indices (séparer par , pour multiple) des réponses correctes (1..6)</label>
                    <input id="adminQuizCorrect" type="text" value="1">
                  </div>
                  <div>
                    <label>Image (optionnelle)</label>
                    <input id="adminQuizImage" type="file" accept="image/*">
                  </div>
                </div>
                <div>
                  <label>Explication / Feedback (apparaîtra après soumission)</label>
                  <textarea id="adminQuestionFeedback" rows="2"></textarea>
                </div>
                <div>
                  <button id="adminBtnSaveQuiz"><i class="fa-solid fa-plus"></i> Ajouter la question</button>
                  <button id="adminBtnPreviewQuiz">Aperçu quiz (comme élève</button>
                </div>
              </div>
            </div>
            <div>
              <div>
                <div><strong>Questions existantes</strong></div>
                <div id="quizQuestionsList"><p>Aucune question pour le moment.</p></div>
              </div>
            </div>
          </div>
          <!-- Dictionary -->
          <div id="tab-dictionary" class="admin-section">
            <div>
              <div>
                <h3>Ajouter un terme au lexique</h3>
                <div>
                  <div>
                    <label>Terme arabe</label>
                    <input id="adminDictAr" type="text" placeholder="مصطلح علمي">
                  </div>
                  <div>
                    <label>Terme français</label>
                    <input id="adminDictFr" type="text" placeholder="Terme scientifique">
                  </div>
                </div>
                <div>
                  <div>
                    <label>Définition</label>
                    <textarea id="adminDictDef" rows="3"></textarea>
                  </div>
                </div>
                <div>
                  <button id="adminBtnSaveDict"><i class="fa-solid fa-plus"></i> Ajouter le terme</button>
                  <button id="adminBtnResetDict">Nouveau terme</button>
                </div>
              </div>
            </div>
            <div>
              <div><div id="dictionaryTermsList"><p>Aucun terme pour le moment.</p></div></div>
            </div>
          </div>
          <!-- Lessons -->
          <div id="tab-lessons" class="admin-section">
            <div>
              <div>
                <h3>Ajouter une leçon</h3>
                <div>
                  <div>
                    <label>Titre de la leçon</label>
                    <input id="adminLessonTitle" type="text">
                  </div>
                  <div>
                    <label>Chapitre</label>
                    <input id="adminLessonChapter" type="text">
                  </div>
                </div>
                <div>
                  <label>Lien Google Drive (PDF)</label>
                  <input type="url" id="adminLessonDriveLink" placeholder="https://drive.google.com/file/d/...">
                </div>
                <div><button id="adminBtnSaveLesson"><i class="fa-solid fa-plus"></i> Ajouter la leçon</button></div>
              </div>
            </div>
            <div><div><div id="lessonsAdminList"><p>Aucune leçon pour le moment.</p></div></div></div>
          </div>
          <!-- Exercises -->
          <div id="tab-exercises" class="admin-section">
            <div>
              <div>
                <h3>Ajouter un exercice</h3>
                <div>
                  <div>
                    <label>Titre</label>
                    <input id="adminExerciseTitle" type="text">
                  </div>
                  <div>
                    <label>Chapitre</label>
                    <input id="adminExerciseChapter" type="text">
                  </div>
                </div>
                <div>
                  <label>Lien Google Drive (PDF)</label>
                  <input type="url" id="adminExerciseDriveLink">
                </div>
                <div><button id="adminBtnSaveExercise">Ajouter l'exercice</button></div>
              </div>
            </div>
            <div><div><div id="exercisesAdminList"><p>Aucun exercice pour le moment.</p></div></div></div>
          </div>
          <!-- Exams -->
          <div id="tab-exams" class="admin-section">
            <div>
              <div>
                <h3>Ajouter un examen</h3>
                <div>
                  <div>
                    <label>Titre</label>
                    <input id="adminExamTitle" type="text">
                  </div>
                  <div>
                    <label>Série</label>
                    <input id="adminExamSeries" type="text">
                  </div>
                </div>
                <div>
                  <label>Lien Google Drive (PDF)</label>
                  <input type="url" id="adminExamDriveLink">
                </div>
                <div><button id="adminBtnSaveExam">Ajouter l'examen</button></div>
              </div>
            </div>
            <div><div><div id="examsAdminList"><p>Aucun examen pour le moment.</p></div></div></div>
          </div>
          <!-- Announcement -->
          <div id="tab-announcement" class="admin-section">
            <div><div>
              <h3>Gestion des Annonces</h3>
              <div>
                <label>Annonce actuelle</label>
                <textarea id="announcementInput" rows="4">ستبدأ الدراسة الفعلية يوم 16/09/2025 نتمنى لتلاميذ والتلميذات سنة دراسية مليئة بالجد ومثمرة</textarea>
              </div>
              <div>
                <label>Image d'annonce (optionnelle)</label>
                <input type="file" id="announcementImageInput" accept="image/*">
                <img id="announcementImagePreview" style="display:none;max-width:200px;margin-top:8px;">
              </div>
              <div>
                <button id="btnSaveAnnouncement">Enregistrer l'annonce</button>
                <button id="btnDeleteAnnouncementImage" style="display:none;">Supprimer image annonce</button>
              </div>
            </div></div>
          </div>
          <!-- Revisions -->
          <div id="tab-revisions" class="admin-section">
            <div><div><h3>Demandes de Récorrection</h3><div id="revisionRequestsList"><p>Aucune demande pour le moment.</p></div></div></div>
          </div>
          <!-- Messages -->
          <div id="tab-messages" class="admin-section">
            <div><div>
              <h3>إرسال رسالة إلى الطلاب</h3>
              <div>
                <label>عنوان الرسالة</label>
                <input id="adminMessageTitle" type="text">
              </div>
              <div>
                <label>محتوى الرسالة</label>
                <textarea id="adminMessageContent" rows="4"></textarea>
              </div>
              <div>
                <label>إرسال إلى</label>
                <select id="adminMessageTarget">
                  <option value="all">جميع الطلاب</option>
                  <option value="specific">طالب محدد</option>
                </select>
              </div>
              <div id="specificStudentContainer" style="display:none;">
                <label>اختر الطالب</label>
                <select id="adminMessageStudent">
                  <option value="">اختر طالباً</option>
                </select>
              </div>
              <div><button id="adminBtnSendMessage">إرسال الرسالة</button></div>
            </div></div>
            <div><div><div id="adminMessagesList"><p>لا توجد رسائل حتى الآن.</p></div></div></div>
          </div>
          <!-- LaTeX Courses -->
          <div id="tab-latex" class="admin-section">
            <div><div>
              <h3>إضافة درس LaTeX (محرر مشابه لـ Overleaf)</h3>
              <div>
                <label>عنوان الدرس</label>
                <input id="latexTitle" type="text" placeholder="أدخل عنوان الدرس">
              </div>
              <div>
                <label>محتوى LaTeX (مؤشّر أسطر مرقّم 1..2000)</label>
                <div>
                  <pre id="latexLineNumbers"></pre>
                  <textarea id="latexCode" rows="12"></textarea>
                </div>
                <small>المعاينة ستكون على الجانب أو في قسم المعاينة أدناه. يستعمل MathJax.</small>
              </div>
              <div>
                <label>وصف الدرس</label>
                <textarea id="latexDescription" rows="2"></textarea>
              </div>
              <div>
                <label>تصنيف</label>
                <input id="latexCategory" type="text">
              </div>
              <div>
                <label>معاينة LaTeX</label>
                <div id="latexPreview">ستظهر المعاينة هنا</div>
              </div>
              <div>
                <button id="btnSaveLatex">حفظ الدرس</button>
                <button id="btnResetLatex">جديد</button>
              </div>
            </div></div>
            <div><div>
              <h4>قائمة دروس LaTeX (الإدارة)</h4>
              <div id="latexContentsList"><p>لا توجد دروس حتى الآن.</p></div>
            </div></div>
          </div>
          <!-- Site Cover -->
          <div id="tab-sitecover" class="admin-section">
            <div><div>
              <h3>صورة واجهة الموقع</h3>
              <div>
                <label>رفع صورة الواجهة</label>
                <input id="siteCoverInput" type="file" accept="image/*">
              </div>
              <div>
                <label>تفعيل عرض صورة الواجهة</label>
                <input id="siteCoverEnable" type="checkbox">
              </div>
              <div><img id="siteCoverPreview" src="" style="display:none;max-width:240px;"></div>
              <div>
                <button id="btnSaveSiteCover">حفظ إعدادات واجهة الموقع</button>
                <button id="btnRemoveSiteCover">إزالة صورة الواجهة</button>
              </div>
            </div></div>
          </div>
          <!-- Slider -->
          <div id="tab-slider" class="admin-section">
            <div><div>
              <h3>Gestion du Slider (sous l'annonce)</h3>
              <div>
                <label>Ajouter image via URL</label>
                <input type="text" id="sliderImageUrl" placeholder="https://..."/>
              </div>
              <div>
                <label>Ou télécharger une image</label>
                <input type="file" id="sliderImageUpload" accept="image/*"/>
              </div>
              <div>
                <button id="btnAddSliderImage">Ajouter au slider</button>
                <button id="btnClearSlider">Vider slider</button>
              </div>
              <div><h4>Slides actuels</h4><div id="sliderAdminList"><p>Aucun slide pour le moment.</p></div></div>
            </div></div>
          </div>
        </div>
      </div>
    </section>
  </div>
  <!-- Login modals -->
  <div id="studentLoginModal" style="display:none;">
    <div>
      <h2>Espace Élève</h2>
      <div>
        <label>Nom d'utilisateur</label>
        <input id="studentUsername" type="text" placeholder="Votre nom d'utilisateur">
      </div>
      <div>
        <label>Mot de passe</label>
        <input id="studentPassword" type="password" placeholder="Votre mot de passe">
      </div>
      <div>
        <button id="cancelStudentLogin">Annuler</button>
        <button id="submitStudentLogin">Se connecter</button>
      </div>
    </div>
  </div>
  <div id="loginModal" style="display:none;">
    <div>
      <h2>Espace Professeur</h2>
      <div>
        <label>Nom d'utilisateur</label>
        <input id="username" type="text" placeholder="Nom d'utilisateur">
      </div>
      <div>
        <label>Mot de passe</label>
        <input id="password" type="password" placeholder="Mot de passe">
      </div>
      <div>
        <button id="cancelLogin">Annuler</button>
        <button id="submitLogin">Se connecter</button>
      </div>
    </div>
  </div>
  <!-- Footer -->
  <footer>
    <div>
      <div>
        <div>
          <h3>Informations de Contact</h3>
          <ul>
            <li><i class="fas fa-user"></i> Professeur: Pr. Ali Bairouk</li>
            <li><i class="fas fa-envelope"></i> Email: bairoukali.contacter@gmail.com</li>
            <li><i class="fas fa-phone"></i> Téléphone: 0620565105</li>
          </ul>
        </div>
        <div>
          <h3>Liens Rapides</h3>
          <ul>
            <li><i class="fas fa-book"></i> Lexique</li>
            <li><i class="fas fa-question-circle"></i> Quiz</li>
            <li><i class="fas fa-chart-line"></i> Notes</li>
          </ul>
        </div>
        <div>
          <h3>À Propos du Site</h3>
          <p>Lycée de l'Excellence est une plateforme éducative spécialisée en physique.</p>
        </div>
      </div>
      <div><p>&copy; 2025 Lycée de l'Excellence. Tous droits réservés</p></div>
    </div>
  </footer>
  <script>
// app.js
// Unified JS for Lycée de l'Excellence
// - Manages students, grades, messages, slider, and revision requests
// - Stores data in localStorage to persist between reloads
// IMPORTANT: This file is intended to replace previous app.js/script.js
(function(){
  'use strict';
  /* ----------------------------
     Helpers & Storage
     ----------------------------*/
  const LS = {
    key(k){ return `lycee_${k}`; },
    load(k, fallback){
      try{ const v = localStorage.getItem(LS.key(k)); return v ? JSON.parse(v) : fallback; }catch(e){ return fallback; }
    },
    save(k, v){ localStorage.setItem(LS.key(k), JSON.stringify(v)); }
  };
  // Data collections
  let students = LS.load('students', []); // {id, fullname, username, password, code, classroom}
  let grades = LS.load('grades', []); // {id, studentId, subject, title, date, score, note, published}
  let messages = LS.load('messages', []); // {id, title, content, target: 'all'|'student', studentId, date}
  let sliderImages = LS.load('sliderImages', []); // {id, src}
  let revisions = LS.load('revisions', []); // {id, gradeId, studentId, message, date, status}
  const saveAll = ()=>{
    LS.save('students', students);
    LS.save('grades', grades);
    LS.save('messages', messages);
    LS.save('sliderImages', sliderImages);
    LS.save('revisions', revisions);
    renderAll();
  };
  const uid = (prefix='id')=> prefix + '_' + Math.random().toString(36).slice(2,9);
  /* ----------------------------
     Utility DOM helpers
     ----------------------------*/
  const $ = sel=> document.querySelector(sel);
  const $$ = sel=> Array.from(document.querySelectorAll(sel));
  function el(tag, props={}, children=[]){
    const e = document.createElement(tag);
    Object.entries(props).forEach(([k,v])=>{ if(k==='class') e.className=v; else if(k==='html') e.innerHTML=v; else e.setAttribute(k,v); });
    (Array.isArray(children)?children:[children]).forEach(c=>{ if(!c) return; if(typeof c === 'string') e.appendChild(document.createTextNode(c)); else e.appendChild(c); });
    return e;
  }
  /* ----------------------------
     Rendering functions
     ----------------------------*/
  function renderStudentsTable(){
    const tbody = $('#studentsTable tbody');
    if(!tbody) return;
    tbody.innerHTML = '';
    students.forEach(s=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${escapeHtml(s.fullname||'')}</td>
        <td>${escapeHtml(s.username||'')}</td>
        <td>${escapeHtml(s.code||'')}</td>
        <td>${escapeHtml(s.classroom||'')}</td>
        <td>
          <button class="btn-edit-student" data-id="${s.id}"><i class="fa-solid fa-pen-to-square"></i></button>
          <button class="btn-del-student" data-id="${s.id}"><i class="fa-solid fa-trash"></i></button>
        </td>
      `;
      tbody.appendChild(tr);
    });
    populateStudentSelects();
  }
  function renderStudentsForAdminSelect(){
    const sel = $('#adminMessageStudent');
    if(!sel) return;
    const previous = sel.value;
    sel.innerHTML = '<option value="">اختر طالباً</option>';
    students.forEach(s=>{
      const opt = document.createElement('option');
      opt.value = s.id;
      opt.textContent = `${s.fullname} (${s.username})`;
      sel.appendChild(opt);
    });
    if(previous) sel.value = previous;
  }
  function renderGrStudentSelects(){
    const grStudent = $('#grStudent');
    const grFilterStudent = $('#grFilterStudent');
    if(grStudent){ grStudent.innerHTML = '<option value="">-- Choisir --</option>'; students.forEach(s=>{ const o = document.createElement('option'); o.value = s.id; o.textContent = `${s.fullname} (${s.username})`; grStudent.appendChild(o); }); }
    if(grFilterStudent){ grFilterStudent.innerHTML = '<option value="">Tous</option>'; students.forEach(s=>{ const o = document.createElement('option'); o.value = s.id; o.textContent = `${s.fullname} (${s.username})`; grFilterStudent.appendChild(o); }); }
  }
  function renderGradesAdminTable(){
    const tbody = $('#gradesAdminTable tbody');
    if(!tbody) return;
    tbody.innerHTML = '';
    grades.forEach(g=>{
      const st = students.find(s=>s.id===g.studentId) || {fullname: 'N/A'};
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${escapeHtml(st.fullname)}</td>
        <td>${escapeHtml(g.date||'')}</td>
        <td>${escapeHtml(g.subject||'')}</td>
        <td>${escapeHtml(g.title||'')}</td>
        <td>${g.score!=null?escapeHtml(g.score.toString()):''}</td>
        <td>${escapeHtml(g.note||'')}</td>
        <td>
          <button class="btn-del-grade" data-id="${g.id}">Supprimer</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }
  function renderStudentRecentGrades(currentStudentId){
    const container = $('#studentRecentGrades');
    if(!container) return;
    const list = grades.filter(g=>g.studentId===currentStudentId && g.published);
    if(list.length===0){ container.innerHTML = '<p>Aucune note disponible pour le moment.</p>'; return; }
    container.innerHTML = '';
    list.slice().sort((a,b)=> new Date(b.date) - new Date(a.date)).forEach(g=>{
      const div = el('div', {}, [
        el('strong', {}, `${g.subject} — ${g.title}`), el('span', {}, ` (${g.date||''}) — ${g.score}/20`)
      ]);
      container.appendChild(div);
    });
  }
  function renderStudentRevisionSelect(currentStudentId){
    const sel = $('#revisionExam');
    if(!sel) return;
    sel.innerHTML = '<option value="">Sélectionnez une évaluation</option>';
    const list = grades.filter(g=>g.studentId===currentStudentId && g.published);
    list.forEach(g=>{
      const opt = document.createElement('option');
      opt.value = g.id;
      opt.textContent = `${g.date||''} — ${g.subject} — ${g.title} — ${g.score}/20`;
      sel.appendChild(opt);
    });
    // Also render a visual list with buttons near the form so student can quickly request
    const helperId = 'revisionQuickList';
    let helper = document.getElementById(helperId);
    if(!helper){ helper = document.createElement('div'); helper.id = helperId; helper.style.marginTop = '12px'; const parent = sel.closest('.revision-request-form'); if(parent) parent.appendChild(helper); }
    helper.innerHTML = '';
    if(list.length===0){ helper.innerHTML = '<p>Aucune évaluation publiée.</p>'; }
    list.forEach(g=>{
      const wrap = document.createElement('div'); wrap.style.display='flex'; wrap.style.gap='10px'; wrap.style.alignItems='center'; wrap.style.marginBottom='6px';
      const info = document.createElement('div'); info.textContent = `${g.date||''} — ${g.subject} — ${g.title} — ${g.score}/20`;
      const btn = document.createElement('button'); btn.textContent='Demander récorrection'; btn.addEventListener('click', ()=>{
        $('#revisionExam').value = g.id; $('#revisionMessage').value = `Je demande la récorrection de l'évaluation "${g.title}" (${g.date}) — note: ${g.score}/20.`; // prefill
        // scroll to form
        $('#revisionMessage').focus();
      });
      wrap.appendChild(info); wrap.appendChild(btn); helper.appendChild(wrap);
    });
  }
  function renderStudentMessages(currentStudentId){
    const container = $('#studentMessagesList');
    if(!container) return;
    const studentMessages = messages.filter(m=> m.target==='all' || (m.target==='student' && m.studentId===currentStudentId));
    if(studentMessages.length===0){ container.innerHTML = '<p>لا توجد رسائل حتى الآن.</p>'; return; }
    container.innerHTML = '';
    studentMessages.slice().sort((a,b)=> new Date(b.date) - new Date(a.date)).forEach(m=>{
      const card = el('div', {}, [ el('h4', {}, m.title || 'رسالة'), el('div', {}, m.content), el('small', {}, new Date(m.date).toLocaleString()) ]);
      container.appendChild(card);
    });
  }
  function renderFrontHeroSlider(){
    const container = $('#front-hero-slider');
    if(!container) return;
    container.innerHTML = '';
    if(sliderImages.length === 0){ container.style.display='none'; return; }
    container.style.display='block';
    container.style.width='100%';
    container.style.overflow='hidden';
    container.style.position='relative';

    const sliderWrapper = document.createElement('div');
    sliderWrapper.style.display='flex';
    sliderWrapper.style.transition='transform 0.5s ease-in-out';
    sliderWrapper.style.width='100%';

    sliderImages.forEach((img, index)=>{
      const slide = document.createElement('div');
      slide.style.minWidth='100%';
      slide.style.display='flex';
      slide.style.justifyContent='center';
      slide.style.alignItems='center';

      const i = document.createElement('img');
      i.src = img.src;
      i.alt = 'Slide ' + (index + 1);
      i.style.width='100%';
      i.style.height='auto';
      i.style.maxHeight='400px';
      i.style.objectFit='cover';

      slide.appendChild(i);
      sliderWrapper.appendChild(slide);
    });

    container.appendChild(sliderWrapper);

    // Start auto-slide
    startAutoSlide(sliderWrapper, sliderImages.length);
  }

  function startAutoSlide(sliderWrapper, totalSlides) {
    let currentIndex = 0;
    setInterval(() => {
      currentIndex = (currentIndex + 1) % totalSlides;
      sliderWrapper.style.transform = `translateX(-${currentIndex * 100}%)`;
    }, 8000); // Change slide every 8 seconds
  }
  function renderSliderAdminList(){
    const container = $('#sliderAdminList');
    if(!container) return;
    container.innerHTML = '';
    if(sliderImages.length===0){ container.innerHTML = '<p>Aucun slide pour le moment.</p>'; return; }
    sliderImages.forEach(img=>{
      const row = document.createElement('div'); row.style.display='flex'; row.style.alignItems='center'; row.style.gap='8px'; row.style.marginBottom='8px';
      const thumb = document.createElement('img'); thumb.src = img.src; thumb.style.width='120px'; thumb.style.height='66px'; thumb.style.objectFit='cover'; thumb.style.border='1px solid #eee';
      const info = document.createElement('div'); info.style.flex='1'; info.textContent = img.id;
      const del = document.createElement('button'); del.textContent='Supprimer'; del.addEventListener('click', ()=>{ sliderImages = sliderImages.filter(x=>x.id!==img.id); saveAll(); });
      row.appendChild(thumb); row.appendChild(info); row.appendChild(del); container.appendChild(row);
    });
  }
  function renderRevisionRequestsAdmin(){
    const container = $('#revisionRequestsList');
    if(!container) return;
    if(revisions.length===0){ container.innerHTML = '<p>Aucune demande pour le moment.</p>'; return; }
    container.innerHTML = '';
    const table = document.createElement('table'); table.style.width='100%'; table.innerHTML = '<thead><tr><th>Étudiant</th><th>Évaluation</th><th>Message</th><th>Date</th><th>Statut</th></tr></thead>';
    const tbody = document.createElement('tbody');
    revisions.slice().reverse().forEach(r=>{
      const st = students.find(s=>s.id===r.studentId) || {fullname:'N/A'};
      const g = grades.find(gg=>gg.id===r.gradeId) || {subject:'N/A', title:'N/A', score:''};
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${escapeHtml(st.fullname)}</td><td>${escapeHtml(g.subject)} - ${escapeHtml(g.title)} - ${g.score}/20</td><td>${escapeHtml(r.message)}</td><td>${escapeHtml(new Date(r.date).toLocaleString())}</td><td>${escapeHtml(r.status)}</td>`;
      tbody.appendChild(tr);
    });
    table.appendChild(tbody); container.appendChild(table);
  }
  /* ----------------------------
     Event handlers & CRUD
     ----------------------------*/
  function setupStudentForm(){
    const saveBtn = $('#btnSaveStudent');
    if(!saveBtn) return;
    saveBtn.addEventListener('click', ()=>{
      const id = $('#stId').value || null;
      const fullname = $('#stFullname').value.trim();
      const username = $('#stUsername').value.trim();
      const password = $('#stPassword').value || 'secret';
      const code = $('#stCode').value.trim();
      const classroom = $('#stClassroom').value.trim();
      if(!fullname || !username){ alert('Nom complet et nom d\'utilisateur requis'); return; }
      if(id){
        const s = students.find(x=>x.id===id);
        if(s){ s.fullname=fullname; s.username=username; s.password=password; s.code=code; s.classroom=classroom; }
      }else{
        if(students.some(x=>x.username===username)){ alert('Nom d\'utilisateur déjà utilisé'); return; }
        const s = {id: uid('stu'), fullname, username, password, code, classroom}; students.push(s);
      }
      // reset
      $('#stId').value=''; $('#stFullname').value=''; $('#stUsername').value=''; $('#stPassword').value=''; $('#stCode').value=''; $('#stClassroom').value='';
      saveAll();
    });
    $('#btnResetStudent') && $('#btnResetStudent').addEventListener('click', ()=>{ $('#stId').value=''; $('#stFullname').value=''; $('#stUsername').value=''; $('#stPassword').value=''; $('#stCode').value=''; $('#stClassroom').value=''; });
    // Table row buttons (delegate)
    document.getElementById('studentsTable').addEventListener('click', (ev)=>{
      const p = ev.target.closest('button'); if(!p) return;
      if(p.classList.contains('btn-edit-student')){
        const id = p.dataset.id; const s = students.find(x=>x.id===id); if(!s) return; $('#stId').value=s.id; $('#stFullname').value=s.fullname; $('#stUsername').value=s.username; $('#stPassword').value=s.password; $('#stCode').value=s.code; $('#stClassroom').value=s.classroom; window.scrollTo({top:0, behavior:'smooth'});
      }
      if(p.classList.contains('btn-del-student')){
        const id = p.dataset.id; if(!confirm('Supprimer cet étudiant ?')) return; students = students.filter(x=>x.id!==id); // also remove grades/messages
        grades = grades.filter(g=>g.studentId!==id); messages = messages.filter(m=> !(m.target==='student' && m.studentId===id)); revisions = revisions.filter(r=> r.studentId!==id); saveAll();
      }
    });
    // Filter students
    $('#filterStudents') && $('#filterStudents').addEventListener('input', (e)=>{
      const q = e.target.value.trim().toLowerCase(); const tbody = $('#studentsTable tbody'); if(!tbody) return; Array.from(tbody.querySelectorAll('tr')).forEach(tr=>{ const name = tr.children[0].textContent.toLowerCase(); tr.style.display = name.includes(q)?'':'none'; });
    });
  }
  function setupGradesForm(){
    $('#btnSaveGrade') && $('#btnSaveGrade').addEventListener('click', ()=>{
      const id = $('#grId').value || null;
      const studentId = $('#grStudent').value; if(!studentId){ alert('Choisissez un étudiant'); return; }
      const subject = $('#grSubject').value.trim(); const title = $('#grTitle').value.trim(); const date = $('#grDate').value || new Date().toISOString().slice(0,10);
      const score = parseFloat($('#grScore').value) || 0; const note = $('#grNote').value.trim();
      if(id){ const g = grades.find(x=>x.id===id); if(g){ g.studentId=studentId; g.subject=subject; g.title=title; g.date=date; g.score=score; g.note=note; g.published = true; } }
      else{ grades.push({id: uid('gr'), studentId, subject, title, date, score, note, published: true}); }
      $('#grId').value=''; $('#grSubject').value=''; $('#grTitle').value=''; $('#grDate').value=''; $('#grScore').value=''; $('#grNote').value=''; saveAll();
    });
    $('#btnResetGrade') && $('#btnResetGrade').addEventListener('click', ()=>{ $('#grId').value=''; $('#grSubject').value=''; $('#grTitle').value=''; $('#grDate').value=''; $('#grScore').value=''; $('#grNote').value=''; });
    // Delete grade
    document.getElementById('gradesAdminTable').addEventListener('click', (ev)=>{
      const p = ev.target.closest('button'); if(!p) return; if(p.classList.contains('btn-del-grade')){ const id=p.dataset.id; if(!confirm('Supprimer la note ?')) return; grades = grades.filter(g=>g.id!==id); saveAll(); }
    });
    // Filter grades by student
    $('#grFilterStudent') && $('#grFilterStudent').addEventListener('change', (e)=>{
      const sid = e.target.value; const tbody = $('#gradesAdminTable tbody'); if(!tbody) return; Array.from(tbody.querySelectorAll('tr')).forEach(tr=>{
        if(!sid) { tr.style.display=''; return; }
        const name = tr.children[0].textContent; const student = students.find(s=>s.fullname===name) || null;
        tr.style.display = (student && student.id===sid)?'':'none';
      });
    });
  }
  function setupMessagesAdmin(){
    $('#adminMessageTarget') && $('#adminMessageTarget').addEventListener('change', (e)=>{
      const v = e.target.value; $('#specificStudentContainer').style.display = v==='specific' ? 'block' : 'none';
    });
    $('#adminBtnSendMessage') && $('#adminBtnSendMessage').addEventListener('click', ()=>{
      const title = $('#adminMessageTitle').value.trim() || 'رسالة من الأستاذ';
      const content = $('#adminMessageContent').value.trim(); if(!content){ alert('Contenu requis'); return; }
      const target = $('#adminMessageTarget').value;
      if(target==='specific'){
        const studentId = $('#adminMessageStudent').value; if(!studentId){ alert('Choisissez un étudiant'); return; }
        messages.push({id: uid('msg'), title, content, target:'student', studentId, date: new Date().toISOString()});
      }else{
        messages.push({id: uid('msg'), title, content, target:'all', date: new Date().toISOString()});
      }
      $('#adminMessageTitle').value=''; $('#adminMessageContent').value=''; $('#adminMessageTarget').value='all'; $('#specificStudentContainer').style.display='none'; saveAll();
    });
  }
  function setupSliderAdmin(){
    $('#btnAddSliderImage') && $('#btnAddSliderImage').addEventListener('click', async ()=>{
      const url = $('#sliderImageUrl').value.trim(); const upload = $('#sliderImageUpload');
      if(!url && (!upload.files || upload.files.length===0)){ alert('Entrez une URL ou téléchargez une image'); return; }
      if(url){ sliderImages.push({id: uid('slide'), src: url}); $('#sliderImageUrl').value=''; saveAll(); return; }
      // file
      const file = upload.files[0];
      const reader = new FileReader();
      reader.onload = function(e){ sliderImages.push({id: uid('slide'), src: e.target.result}); saveAll(); $('#sliderImageUpload').value=''; };
      reader.readAsDataURL(file);
    });
    $('#btnClearSlider') && $('#btnClearSlider').addEventListener('click', ()=>{ if(!confirm('Vider slider ?')) return; sliderImages = []; saveAll(); });
    // handle direct upload preview when selecting file
    $('#sliderImageUpload') && $('#sliderImageUpload').addEventListener('change', (e)=>{
      const f = e.target.files && e.target.files[0]; if(!f) return; const p = $('#sliderAdminList'); if(!p) return; // nothing else
    });
  }
  function setupRevisionForm(){
    const form = $('#revisionRequestForm'); if(!form) return;
    form.addEventListener('submit', (ev)=>{
      ev.preventDefault(); const gradeId = $('#revisionExam').value; const message = $('#revisionMessage').value.trim();
      const current = sessionStorage.getItem('currentStudent'); if(!current){ alert('Vous devez être connecté en tant qu\'élève'); return; }
      const st = JSON.parse(current);
      if(!gradeId){ alert('Sélectionnez une évaluation'); return; }
      revisions.push({id: uid('rev'), gradeId, studentId: st.id, message, date: new Date().toISOString(), status: 'pending'});
      $('#revisionMessage').value=''; saveAll(); alert('Demande envoyée');
    });
  }
  /* ----------------------------
     Auth & Student view
     ----------------------------*/
  function setupLoginModals(){
    // open/close modals
    $('#studentLoginBtn') && $('#studentLoginBtn').addEventListener('click', ()=>{ $('#studentLoginModal').style.display='block'; });
    $('#loginBtn') && $('#loginBtn').addEventListener('click', ()=>{ $('#loginModal').style.display='block'; });
    $('#cancelStudentLogin') && $('#cancelStudentLogin').addEventListener('click', ()=>{ $('#studentLoginModal').style.display='none'; });
    $('#cancelLogin') && $('#cancelLogin').addEventListener('click', ()=>{ $('#loginModal').style.display='none'; });
    // Teacher login (for demo purpose: any credentials accepted to open admin-panel)
    $('#submitLogin') && $('#submitLogin').addEventListener('click', ()=>{
      $('#loginModal').style.display='none'; $('#admin-panel').style.display='block'; window.scrollTo({top:0}); renderAll();
    });
    // Student login
    $('#submitStudentLogin') && $('#submitStudentLogin').addEventListener('click', ()=>{
      const username = $('#studentUsername').value.trim(); const password = $('#studentPassword').value;
      const s = students.find(x=> x.username===username && x.password===password);
      if(!s){ alert('Combinaison invalide'); return; }
      sessionStorage.setItem('currentStudent', JSON.stringify(s)); $('#studentLoginModal').style.display='none'; showStudentArea(s);
    });
    $('#studentLogoutBtn') && $('#studentLogoutBtn').addEventListener('click', ()=>{ sessionStorage.removeItem('currentStudent'); $('#student-dashboard').style.display='none'; });
    $('#logoutBtn') && $('#logoutBtn').addEventListener('click', ()=>{ $('#admin-panel').style.display='none'; });
  }
  function showStudentArea(student){
    $('#student-dashboard').style.display='block';
    $('#studentWelcome').textContent = `Bienvenue, ${student.fullname}`;
    renderStudentRecentGrades(student.id);
    renderStudentMessages(student.id);
    renderStudentRevisionSelect(student.id);
    // populate student info on grades page
    const studentInfo = $('#studentInfo'); if(studentInfo) studentInfo.textContent = `${student.fullname} — ${student.classroom || ''} — ${student.code || ''}`;
    // fill grades table for grades page when looked up by code
    renderStudentGradesTableForStudent(student.id);
  }
  function renderStudentGradesTableForStudent(studentId){
    const rows = $('#gradesTable tbody'); if(!rows) return; rows.innerHTML='';
    const list = grades.filter(g=>g.studentId===studentId);
    if(list.length===0){ $('#noGradesMsg').style.display='block'; rows.innerHTML=''; return; }
    $('#noGradesMsg').style.display='none';
    list.forEach(g=>{ const tr = document.createElement('tr'); tr.innerHTML = `<td>${escapeHtml(g.date)}</td><td>${escapeHtml(g.subject)}</td><td>${escapeHtml(g.title)}</td><td>${g.score}/20</td><td>${escapeHtml(g.note||'')}</td>`; rows.appendChild(tr); });
  }
  /* ----------------------------
     Init & wiring
     ----------------------------*/
  function populateStudentSelects(){ renderStudentsForAdminSelect(); renderGrStudentSelects(); }
  function renderAll(){
    renderStudentsTable(); renderGrStudentSelects(); renderGradesAdminTable(); renderSliderAdminList(); renderFrontHeroSlider(); renderRevisionRequestsAdmin(); renderStudentsForAdminSelect();
    // If a student is logged in, refresh their view
    const cur = sessionStorage.getItem('currentStudent'); if(cur){ const s = JSON.parse(cur); showStudentArea(s); }
  }
  function escapeHtml(s){ if(!s && s!==0) return ''; return String(s).replace(/[&<>"]/g, c=> ({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;'}[c])); }
  function hookNav(){
    // Site nav links
    $$('.nav-link').forEach(a=> a.addEventListener('click', (e)=>{
      e.preventDefault(); const sec = a.dataset.section; if(!sec) return; $$('.page-section').forEach(ps=> ps.style.display='none'); const target = $(`#${sec}`); if(target) target.style.display='block'; window.scrollTo({top:0});
    }));
    // Admin left menu
    $$('.admin-tab-link').forEach(l=> l.addEventListener('click', (ev)=>{ ev.preventDefault(); $$('.admin-tab-link').forEach(x=>x.classList.remove('active')); l.classList.add('active'); const tab = l.dataset.tab; $$('.admin-section').forEach(s=> s.style.display='none'); const show = $(`#${tab}`); if(show) show.style.display='block'; }));
    // Student tabs
    $$('.student-tab').forEach(t=> t.addEventListener('click', ()=>{ $$('.student-tab').forEach(x=>x.classList.remove('active')); t.classList.add('active'); $$('.student-tab-content').forEach(c=> c.style.display='none'); const tab = t.dataset.tab; const mapping = {dashboard: 'student-dashboard-tab', quiz: 'student-quiz-tab', exercises:'student-exercises-tab', dictionary:'student-dictionary-tab', revision:'student-revision-tab', messages:'student-messages-tab', cours:'student-cours-tab'}; const id = mapping[tab]; if(id){ document.getElementById(id).style.display='block'; } }));
  }
  function wireQuickSearchByCode(){
    $('#btnSearchByCode') && $('#btnSearchByCode').addEventListener('click', ()=>{
      const code = $('#searchCode').value.trim(); if(!code){ alert('Entrez un Code Parcours'); return; }
      const st = students.find(s=> s.code===code);
      if(!st){ alert('Aucun étudiant trouvé pour ce code'); return; }
      // show grades results section
      $('#gradesResults').style.display='block'; $('#studentInfo').textContent = `${st.fullname} — ${st.classroom || ''}`; renderStudentGradesTableForStudent(st.id);
    });
  }
  /* ----------------------------
     Initial sample data (only if empty)
     ----------------------------*/
  function seedIfEmpty(){
    let changed = false;
    if(students.length===0){ students.push({id: 'stu_demo', fullname: 'Demo Élève', username: 'demo', password: 'demo', code: 'P-2025-001', classroom:'2ème Bac Sciences Physiques'}); changed = true; }
    if(grades.length===0){ grades.push({id: 'gr_demo1', studentId: 'stu_demo', subject:'Électricité', title:'Contrôle 1', date:'2025-06-10', score:14.5, note:'Bien', published:true}); grades.push({id:'gr_demo2', studentId:'stu_demo', subject:'Mécanique', title:'TP 2', date:'2025-05-02', score:12, note:'OK', published:true}); changed = true; }
    if(sliderImages.length===0){ sliderImages.push({id:'slide_demo', src:'https://images.unsplash.com/photo-1503676260728-1c00da094a0b?w=1200&auto=format&fit=crop&q=60'}); changed=true; }
    if(changed) saveAll();
  }
  /* ----------------------------
     Start app
     ----------------------------*/
  function init(){
    seedIfEmpty();
    setupStudentForm(); setupGradesForm(); setupMessagesAdmin(); setupSliderAdmin(); setupRevisionForm(); setupLoginModals(); hookNav(); wireQuickSearchByCode(); renderAll();
    // expose some functions for debugging
    window.__lycee_storage = {students, grades, messages, sliderImages, revisions};
  }
  // run
  document.readyState === 'loading' ? document.addEventListener('DOMContentLoaded', init) : init();
})();
  </script>
</body>
</html>